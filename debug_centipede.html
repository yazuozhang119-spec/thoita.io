<!DOCTYPE html>
<html>
<head>
    <title>蜈蚣渲染调试</title>
</head>
<body>
    <h1>蜈蚣渲染调试</h1>
    <canvas id="debugCanvas" width="800" height="600" style="border: 1px solid black;"></canvas>
    <div id="log"></div>

    <script>
        // 模拟蜈蚣渲染测试
        const canvas = document.getElementById('debugCanvas');
        const ctx = canvas.getContext('2d');
        const logDiv = document.getElementById('log');

        function log(message) {
            console.log(message);
            logDiv.innerHTML += message + '<br>';
        }

        // 颜色混合函数
        function blendColor(color1, color2, t) {
            const rgb1 = {
                r: parseInt(color1.slice(1, 3), 16),
                g: parseInt(color1.slice(3, 5), 16),
                b: parseInt(color1.slice(5, 7), 16)
            };
            const rgb2 = {
                r: parseInt(color2.slice(1, 3), 16),
                g: parseInt(color2.slice(3, 5), 16),
                b: parseInt(color2.slice(5, 7), 16)
            };
            return rgbToHex(Math.floor(rgb1.r * (1 - t) + rgb2.r * t),
                          Math.floor(rgb1.g * (1 - t) + rgb2.g * t),
                          Math.floor(rgb1.b * (1 - t) + rgb2.b * t));
        }

        function rgbToHex(r, g, b) {
            return "#" + componentToHex(r) + componentToHex(g) + componentToHex(b);
        }

        function componentToHex(c) {
            var hex = c.toString(16);
            return hex.length == 1 ? "0" + hex : hex;
        }

        // 蜈蚣绘制函数
        function drawCentipede(x, y, size, angle, isHead) {
            log(`drawCentipede 被调用: x=${x}, y=${y}, size=${size}, angle=${angle.toFixed(3)}, isHead=${isHead}`);

            let bodyColor = blendColor("#8ac255", "#FF0000", Math.max(0, 0));
            let sideColor = blendColor("#333333", "#FF0000", Math.max(0, 0));

            const e = {
                render: {
                    angle: angle,
                    radius: size / 2
                }
            };

            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(e.render.angle);

            // side
            ctx.fillStyle = sideColor;
            ctx.beginPath();
            ctx.arc(0, e.render.radius * 0.85, e.render.radius * 0.44, 0, 2 * Math.PI);
            ctx.fill();
            ctx.closePath();
            ctx.beginPath();
            ctx.arc(0, -e.render.radius * 0.85, e.render.radius * 0.44, 0, 2 * Math.PI);
            ctx.fill();
            ctx.closePath();

            // main body
            ctx.fillStyle = bodyColor;
            ctx.beginPath();
            ctx.arc(0, 0, e.render.radius, 0, 2 * Math.PI);
            ctx.fill();
            ctx.closePath();

            if (isHead === true) {
                ctx.strokeStyle = sideColor;
                ctx.lineWidth = e.render.radius * .075;

                // antennae
                ctx.beginPath();
                ctx.moveTo(e.render.radius * .71, -e.render.radius * .29);
                ctx.quadraticCurveTo(e.render.radius * 1.35, -e.render.radius * .33, e.render.radius * 1.57, -e.render.radius * .87);
                ctx.stroke();
                ctx.closePath();

                ctx.beginPath();
                ctx.moveTo(e.render.radius * .71, e.render.radius * .29);
                ctx.quadraticCurveTo(e.render.radius * 1.35, e.render.radius * .33, e.render.radius * 1.57, e.render.radius * .87);
                ctx.stroke();
                ctx.closePath();

                // little bulbs at the ends
                ctx.fillStyle = ctx.strokeStyle;
                ctx.beginPath();
                ctx.arc(e.render.radius * 1.57, -e.render.radius * .87, e.render.radius * .132, 0, Math.PI * 2);
                ctx.fill();
                ctx.closePath();

                ctx.beginPath();
                ctx.arc(e.render.radius * 1.57, e.render.radius * .87, e.render.radius * .132, 0, Math.PI * 2);
                ctx.fill();
                ctx.closePath();
            }

            ctx.restore();
        }

        // 测试渲染
        log('开始测试蜈蚣渲染...');

        // 清空画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 绘制头部
        log('绘制蜈蚣头部 (centipede0):');
        drawCentipede(200, 200, 50, 0, true);

        // 绘制身体
        log('绘制蜈蚣身体 (centipede1):');
        drawCentipede(350, 200, 40, 0, false);
        drawCentipede(450, 200, 40, 0, false);
        drawCentipede(550, 200, 40, 0, false);

        log('测试完成！');
    </script>
</body>
</html>