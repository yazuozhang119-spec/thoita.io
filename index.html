<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta charset="latin-1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Florr.io 网页版</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>
        <button id="exitButton" class="exit-button">×</button>
        <div id="ui">
            <div id="healthBar">
                <div id="healthFill"></div>
            </div>
            <div id="fps">FPS: 0</div>
            <div id="inventory">
                <!-- 装备的花瓣将通过JavaScript动态生成 -->
            </div>
        </div>
        <div id="waveBar">
            <div id="waveText">Wave: 1</div>
            <div id="waveProgressContainer">
                <div id="waveProgressFill"></div>
            </div>
        </div>

        <div id="creditsDisplay" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); color: gold; padding: 5px 10px; border-radius: 5px; font-size: 14px; display: none;">
            💰 <span id="creditsAmount">0</span> 积分
        </div>

        <div id="startScreen">
            <h1>thoita.io</h1>

            <!-- 登录表单 -->
            <div id="loginForm" class="auth-form">
                <h2>登录账户</h2>
                <div class="form-group">
                    <input type="text" id="loginUsername" placeholder="用户名" maxlength="20">
                </div>
                <div class="form-group">
                    <input type="password" id="loginPassword" placeholder="密码" maxlength="50">
                </div>
                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="rememberMe" checked>
                        <span>记住密码</span>
                    </label>
                </div>
                <button id="loginButton" class="auth-button">登录</button>
                <p class="auth-switch">
                    还没有账户？<a href="#" id="showRegister">立即注册</a>
                </p>
            </div>

            <!-- 注册表单 -->
            <div id="registerForm" class="auth-form" style="display: none;">
                <h2>注册账户</h2>
                <div class="form-group">
                    <input type="text" id="registerUsername" placeholder="用户名" maxlength="20">
                </div>
                <div class="form-group">
                    <input type="password" id="registerPassword" placeholder="密码" maxlength="50">
                </div>
                <div class="form-group">
                    <input type="password" id="confirmPassword" placeholder="确认密码" maxlength="50">
                </div>
                <div class="form-options">
                    <label class="checkbox-label">
                        <input type="checkbox" id="registerRememberMe" checked>
                        <span>记住密码</span>
                    </label>
                </div>
                <button id="registerButton" class="auth-button">注册</button>
                <p class="auth-switch">
                    已有账户？<a href="#" id="showLogin">立即登录</a>
                </p>
            </div>

            <!-- 错误信息显示 -->
            <div id="authError" class="auth-error" style="display: none;"></div>

            <!-- 旧版本兼容（隐藏） -->
            <div id="legacyLogin" style="display: none;">
                <input type="text" id="playerName" placeholder="输入你的名字" value="Player">
                <button id="startButton">开始游戏</button>
            </div>
        </div>

        <!-- 大厅界面 - 与登录界面平级 -->
        <div id="lobbyUI" style="display:none;">
            <div id="lobbyLayout">
                <div id="leftPanel">
                    <div id="buttonContainer">
                        <button class="lobby-button" id="bagButton">背包</button>
                                                <button class="lobby-button" id="absorbLobbyButton">合成</button>
                        <button class="lobby-button" id="galleryButton">图鉴</button>
                    </div>
                </div>

                <div id="mainPanel">
                    <!-- 大厅标题 -->
                    <h1 id="lobbyTitle" style="color: white; text-align: center; margin: 20px 0; font-size: 48px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5);">thoita.io</h1>
                    <div id="equipmentSlots">
                        <!-- 装备槽将通过JS动态生成 -->
                    </div>

                    <div id="selectRoomMessage" style="color: white; font-size: 16px; margin-bottom: 15px; text-align: center; display: none;">请选择房间</div>
                    <div id="roomButtons" style="display: flex; gap: 10px; margin-bottom: 10px; justify-content: center;">
                    <button id="newRoomButton" class="room-action-button">新建房间</button>
                    <button id="findRoomButton" class="room-action-button">寻找</button>
                    <button id="privateRoomButton" class="room-action-button">私人房间</button>
                </div>
                <button id="readyButton">Ready</button>

                    <div id="roomInfo">
                        <div id="noRoomMessage" style="color: rgba(255, 255, 255, 0.6); font-size: 14px; text-align: center; padding: 20px;">没有房间信息</div>
                        <div id="roomWaveSettings" style="display: none;">
                            <div class="wave-setting-container">
                                <label for="startWaveSlider"></label>
                                <div class="slider-container">
                                    <input type="range" id="startWaveSlider" min="0" max="1" value="1" class="wave-slider">
                                    <div class="slider-value-display">
                                        <span id="startWaveValue">1</span>
                                    </div>
                                </div>
                            </div>
                            <div class="wave-info-container">
                                <div class="wave-info-item">
                                    <span class="wave-info-label">房间起始波次:</span>
                                    <span id="roomStartWave" class="wave-info-value">1</span>
                                </div>
                                <div class="wave-info-item">
                                    <span class="wave-info-label">你的起始波次:</span>
                                    <span id="playerStartWave" class="wave-info-value">1</span>
                                </div>
                            </div>
                        </div>
                        <div id="roomPlayers">
                            <h4>房间玩家</h4>
                            <!-- 房间内其他玩家将通过JS动态生成 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="bagWindow">
            <button class="close-button" id="closeBag">X</button>
            <div id="bagContent">
                <!-- 背包内容将通过JS动态生成 -->
            </div>
        </div>

        <!-- 自定义tooltip -->
        <div id="petalTooltip" class="petal-tooltip" style="display: none;">
            <div class="tooltip-content"></div>
        </div>

        <div id="absorbWindow">
            <button class="close-button" id="closeAbsorb">X</button>

            <!-- 五边形排列的五个合成槽位 -->
            <div id="absorbSlotsContainer">
                <div class="pentagon-slots">
                    <div class="absorb-slot" data-index="0"></div>
                    <div class="absorb-slot" data-index="1"></div>
                    <div class="absorb-slot" data-index="2"></div>
                    <div class="absorb-slot" data-index="3"></div>
                    <div class="absorb-slot" data-index="4"></div>
                </div>
                <div id="absorbCenter">
                    <div id="absorbButtonContainer">
                        <button id="absorbActionButton" disabled>合成</button>
                        <div id="absorbChanceText" style="font-size: 12px; color: #888; margin-top: 5px; min-height: 16px; white-space: nowrap;"></div>
                        <div id="pityInfoText" style="font-size: 11px; color: #666; margin-top: 3px; min-height: 14px; white-space: nowrap;"></div>
                    </div>
                </div>
            </div>

            <!-- 合成结果显示区域 -->
            <div id="absorbResult" style="display: none;">
                <h3>合成结果</h3>
                <div id="resultContent"></div>
                <button id="closeResult">关闭</button>
            </div>

            <!-- 花瓣选择区域 -->
            <div class="petal-selection-area">
                <div id="absorbPetalSelection" class="petal-selection">
                    <!-- 花瓣将通过JavaScript动态生成 -->
                </div>
            </div>
            </div>
        </div>

        <div id="checkinWindow">
            <div class="checkin-light-cones" id="checkinLightCones"></div>
                        <div id="checkinStreakDisplay" style="display: none;">
                <div id="checkinStreakText"></div>
            </div>
            <div id="checkinContent">
                <div id="checkinStatus">
                    <p id="checkinMessage">正在获取签到状态...</p>
                </div>
                <div id="checkinRewardDisplay" style="display: none;">
                    <div id="checkinRewardText">Reward:</div>
                    <div id="checkinRewardItems"></div>
                    <div id="checkinCreditsReward" style="display: none; margin-top: 10px;">
                        <div style="color: gold; font-weight: bold;">💰 积分奖励: <span id="checkinCreditsAmount"></span></div>
                        <div id="creditsRewardBreakdown" style="font-size: 12px; color: #ccc; margin-top: 5px;"></div>
                    </div>
                </div>
                <div id="checkinButtonContainer">
                    <button id="checkinActionButton" class="checkin-button" disabled>CLAIM</button>
                </div>
            </div>
        </div>

        <div id="galleryWindow">
            <button class="close-button" id="closeGallery">X</button>
            <div class="gallery-content">
                <div class="monster-selection-area">
                    <div id="monsterSelection" class="monster-selection">
                        <!-- 怪物将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>

        <div id="gameOver">
            <h2>游戏结束</h2>
            <button id="restartButton">重新开始</button>
        </div>

        <!-- 死亡时显示的拾取掉落物 -->
        <div id="deathDrops" style="display: none;">
            <div id="deathDropsHeader">
                <h3>拾取的掉落物</h3>
            </div>
            <div id="deathDropsContent">
                <!-- 掉落物将按照背包排列方式显示 -->
            </div>
        </div>

        <div id="loadingScreen">
            <h2>加载资源</h2>
            <div id="progressBar">
                <div id="progressFill"></div>
            </div>
            <div id="loadingText">0%</div>
        </div>

        <!-- 聊天界面 -->
        <div id="chatContainer">
            <div id="chatHeader">
                <span id="chatTitle">聊天</span>
                <div>
                    <button id="chatClose">×</button>
                </div>
            </div>
            <div id="chatMessages"></div>
            <div id="chatTypeSelector">
                <button class="chat-type-button active" data-type="room">房间</button>
                <button class="chat-type-button" data-type="global">全局</button>
                <button class="chat-type-button" data-type="private">私聊</button>
            </div>
            <div id="chatInputContainer">
                <input type="text" id="chatInput" placeholder="输入消息..." maxlength="200">
                <button id="chatSendButton">发送</button>
            </div>
        </div>

        <!-- 重新打开聊天按钮 -->
        <button id="chatOpenButton" style="display: none;">💬</button>

        <!-- 设置按钮 -->
        <div id="settingsButton">
            <button id="settingsToggle" class="settings-button">⚙️</button>
        </div>

        <!-- 商店按钮 -->
        <div id="shopButton">
            <button id="shopToggle" class="shop-button">🏪</button>
        </div>

        <!-- 设置面板 -->
        <div id="settingsPanel" class="settings-panel" style="display: none;">
            <div class="settings-header">
                <span>设置</span>
                <button id="settingsClose" class="settings-close">×</button>
            </div>
            <div class="settings-content">
                <!-- 键盘移动 -->
                <div class="settings-section">
                    <div class="setting-toggle">
                        <label class="toggle-label">
                            <input type="checkbox" id="keyboardMovementToggle">
                            <span class="toggle-text">键盘移动</span>
                        </label>
                        <div class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>

                <!-- 音量控制 -->
                <div class="settings-section">
                    <div class="volume-control-horizontal">
                        <span class="volume-label">音量</span>
                        <div class="volume-slider-wrapper">
                            <input type="range" id="volumeRange" min="0" max="100" value="50" class="volume-slider">
                            <span id="volumeValue">50%</span>
                        </div>
                    </div>
                </div>

                <!-- 显示实体 -->
                <div class="settings-section">
                    <div class="setting-toggle">
                        <label class="toggle-label">
                            <input type="checkbox" id="showEntitiesToggle" checked>
                            <span class="toggle-text">显示实体</span>
                        </label>
                        <div class="toggle-switch">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 商店面板 -->
        <div id="shopPanel" class="shop-panel" style="display: none;">
            <div class="shop-header">
                <span>🏪 商店</span>
                <div class="shop-credits">
                    <span id="shopCreditsAmount">0</span> 积分
                </div>
                <button id="shopClose" class="shop-close">×</button>
            </div>

            <div class="shop-content">
                <!-- 商品列表 -->
                <div id="shopItemsList" class="shop-items-list">
                    <!-- 商品将通过JavaScript动态生成 -->
                </div>

                <!-- 加载中状态 -->
                <div id="shopLoading" class="shop-loading" style="display: none;">
                    <div class="loading-spinner"></div>
                    <span>加载商店数据...</span>
                </div>

                <!-- 空状态 -->
                <div id="shopEmpty" class="shop-empty" style="display: none;">
                    <div class="shop-empty-icon">🏪</div>
                    <div class="shop-empty-title">商店休息中</div>
                    <div class="shop-empty-desc">明天再来逛逛吧！</div>
                </div>
            </div>
        </div>

        <!-- 商店购买确认弹窗 -->
        <div id="shopPurchaseModal" class="shop-purchase-modal">
            <div class="shop-purchase-dialog">
                <div class="shop-purchase-title">确认购买</div>
                <div class="shop-purchase-item" id="purchaseItemName">商品名称</div>
                <div class="shop-purchase-price">💰 <span id="purchaseItemPrice">0</span> 积分</div>
                <div class="shop-purchase-buttons">
                    <button id="purchaseConfirm" class="shop-purchase-confirm">确认购买</button>
                    <button id="purchaseCancel" class="shop-purchase-cancel">取消</button>
                </div>
            </div>
        </div>

        </div>

    <script src="flower.js"></script>
    <script src="petals_data.js"></script>
    <script src="monsters_data.js"></script>
    <script src="game.js"></script>
    <script src="auth.js"></script>
</body>
</html>